We check whether the strong simulation implies failure-refinement. We found that this is not the case. We start by defining the failure of a process.
The pair $(t, X)$ is called a $failure$, where $t$ is a trace and $X$ is a set of impossible next actions. Any process
$P$ is assigned a set of failures $F$. Formally, this means:
\begin{align}
    \failures[P] \define \{(t,X) \mid \exists Q\in\procs: \ec{P} \bigstep{t} \ec{Q}\wedge X\in Refusals\}
\label{failure}
\end{align}
where: \[Refusals \define \pom{\actions\setminus\set{\tau}}\]

We can define the failure-refinement of \picalc{} processes as follow:

\begin{definition}[\index{refinement}{Failure refinement}]
\label{def_failure_ref}
	Let $P,Q\in\procs$, then $P$ is a \findex[trace!refinement]{failure refinement} of $Q$ ($Q\refiF P$) iff the inverse set inclusion of traces and failure holds:
\begin{align}
   \ec{Q} \refiF \ec{P} \Leftrightarrow  \traces[P]\subseteq\traces[Q] \wedge \failures[P]\subseteq\failures[Q]
\end{align}
	We also say for $Q\refi{}P$ that $P$ \findex[refinement]{refines} $Q$.
\end{definition}

From \refPro{property1} and \refDef{def_failure_ref} we can drive the following Corollary: 

\begin{cor}[Simulation and Failure refinement]
\label{cor_sim_failure_refinement}
Let $P,Q\in\procs$ processes. If $\ec{Q}$ strongly simulates $\ec{P}$, then $\ec{P}$ refines $\ec{Q}$ in failure-refinement model. Formally written:
\begin{align}
    (\ec{P},\ec{Q})\in{}\simu  \Rightarrow \ec{Q} \refiF \ec{P}
   \label{failure_model}
\end{align}
does not hold.
\end{cor}%%

\begin{prf}
by counter example. Assume that \refCor{cor_sim_failure_refinement} holds and consider our vending machine $VM$, that offers $coffee$ and $tea$, against another vending machine $VM\_Half$ which does not offer $tea$. We will use ABC to check the simulation. Due to performance issue, we will limit the check to behavior part. That is, we are not comparing the combination $\pi$-OZ, but only the $\pi$ part   without data, as shown in \refFig{vm_and_vmHalf}. We would like to show that if $\ec{VM\_PI}$ strongly simulates $\ec{VM\_Half\_PI}$, then $\ec{VM\_Half\_PI}$ refines $\ec{VM\_PI}$. Formally: $(\ec{VM\_Half\_PI},\ec{VM\_PI})\in{}\simu  \Rightarrow \ec{VM\_PI} \refiF \ec{VM\_Half\_PI}$.
\begin{figure}[H]%
\centering
\subcaptionbox{$P$}{\fbox{{
\begin{tikzpicture}[->,>=stealth',shorten >=1pt,auto,node distance=4cm,
                    semithick]
  \tikzstyle{every state}=[]

  \node[state] (A)                    {$VM\_Half\_PI$};
  \path (A) edge [loop above] node {$coffee,talk$} (A);
\end{tikzpicture}    
    }}}%
\qquad
\subcaptionbox{$Q$}{\fbox{{
    \begin{tikzpicture}[->,>=stealth',shorten >=1pt,auto,node distance=3cm,
                    semithick]
  \tikzstyle{every state}=[]

  \node[state] (A)                    {$VM\_PI$};
  \path (A) edge [loop above] node {$coffee,tea,talk$} (A);
\end{tikzpicture}
 }}}%
\caption{$VM$ and $VM\_Half$}
\label{vm_and_vmHalf}
\end{figure}

\refLis{vm_and_vmHalf_ABC} shows the ABC implementation of VM\_PI and VM\_Half\_PI and \refLis{vm_and_vmHalf_ABC_check1} shows the result of checking if VM\_PI simulates VM\_Half\_PI, which passes\\

\lstinputlisting[backgroundcolor=\color{white},caption={ VM ($\pi$-part) in ABC code.},captionpos=b, label={vm_and_vmHalf_ABC}]{listings/vm_and_vmHalf_ABC.abc}


\lstinputlisting[backgroundcolor=\color{white},caption={check if $VM\_PI$ simulates $VM\_Half\_PI$.},captionpos=b, label={vm_and_vmHalf_ABC_check1}]{listings/check_VM_and_VM_Half1.abc}

\refLis{vm_and_vmHalf_ABC_check1} says that VM\_PI strongly simulates VM\_Half\_PI. This result implies, according to \refCor{cor_sim_failure_refinement}, that VM\_Half\_PI refines VM\_PI in the failure model, thus we need to show that $\traces[VM\_Half\_PI]\subseteq\traces[VM\_PI] \wedge \failures[VM\_Half\_PI]\subseteq\failures[VM\_PI]$.
\begin{itemize}
\item For $\traces[VM\_Half\_PI]\subseteq\traces[VM\_PI]$: we need to determine the traces of VM\_PI and VM\_Half\_PI  shown in \refFig{vm_and_vmHalf}. According to \ref{determine_trace}:

    \[\traces[VM\_PI] \define \{coffee(),tea(),talk<>\}^\ast\]
    \[\traces[VM\_Half\_PI] \define \{coffee(),talk<>\}^\ast\]
It is clear that $\traces[VM\_Half\_PI]\subseteq\traces[VM\_PI]$ holds. 

\item For $\failures[VM\_Half\_PI]\subseteq\failures[VM\_PI]$: let $\epsilon$ be the empty trace, then
    \[\failures[VM\_PI] \define \{(\epsilon,\{\}),\dots\}^\ast\]
    \[\failures[VM\_Half\_PI] \define \{(\epsilon,\{tea\}),\dots\}^\ast\]
It is clear that $\failures[VM\_Half\_PI]\not\subseteq\failures[VM\_PI]$, thus $\ec{VM\_PI} \not\refiF \ec{VM\_Half\_PI}$. So, strong simulation does not imply failure-refinement. 
\end{itemize}
\end{prf}
